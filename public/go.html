<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>문서로 이동 중...</title>
  <script>
    window.onload = function () {
      const params = new URLSearchParams(window.location.search);
      const doc = params.get('doc');

      const redirectMap = {
        발주확인페이지: "https://docs.google.com/spreadsheets/d/1FAYigya47GJWfTm4yysQSY9WCTDV8b0Du_rYnAtYug0/edit",
        구매페이지:       "https://sites.google.com/view/misslee-smart-pac/%EC%8A%A4%EB%A7%88%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%8B%9C%EC%8A%A4%ED%85%9C/%EA%B5%AC%EB%A7%A4%EC%9E%90%EC%9E%AC%EA%B4%80%EB%A6%AC?authuser=0",
        구매캘린더:       "https://calendar.google.com/calendar/u/0?cid=dTM3dGF0ZzVrYWo3cTZlcnU2bTJvOXZyODBAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ",
        대시보드:         "https://docs.google.com/spreadsheets/d/1YMH0u-NRghspwapeczB-siQPs022f3H2EFVp7tPX31s/edit?usp=sharing",
        카카오토큰발급:   "https://docs.google.com/spreadsheets/d/15RDzwxbuo2X3B95axNaU41rj0ZECxfpu4nySK9sjy60/edit?usp=sharing",
        공구관리점검표: "https://sites.google.com/view/misslee-smart-pac/%EC%8A%A4%EB%A7%88%ED%8A%B8%EC%9B%8C%ED%81%AC-%EC%8B%9C%EC%8A%A4%ED%85%9C/%EC%84%A4%EB%B9%84%EA%B4%80%EB%A6%AC",
        온습도점검표: "https://docs.google.com/forms/d/e/1FAIpQLSfq-T-5e9rJ45thY8C-bQOa_BWCD8Qn1J633f10OKt_FxmhUw/viewform",
        생산메인화면: "https://docs.google.com/spreadsheets/d/1jAcpu4xP3XbA9qSLXOjr3WoMys4YSKvHk_1M-0FH9Ds/edit?gid=2017400441#gid=2017400441",
        미쓰리서명앱: "https://misslee-signature-dashboard.vercel.app/dashboard"
      };

      let target = redirectMap[doc];
      if (!target) {
        document.body.innerHTML = "<h2>❌ 문서를 찾을 수 없습니다.</h2>";
        return;
      }

      // ─── 스프레드시트 딥링크 ───
      if (target.includes("docs.google.com/spreadsheets/d/")) {
        const match = target.match(/\/d\/([^\/]+)/);
        const sheetId = match && match[1];
        const webUrl = target;
        if (sheetId) {
          if (/Android/.test(navigator.userAgent)) {
            target =
              `intent://docs.google.com/spreadsheets/d/${sheetId}/edit` +
              `#Intent;scheme=https;package=com.google.android.apps.docs;` +
              `S.browser_fallback_url=${encodeURIComponent(webUrl)};end`;
          }
          else if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
            target = `googlesheets://docs.google.com/spreadsheets/d/${sheetId}/edit`;
          }
          else {
            target = webUrl;
          }
        }
      }

      // ─── 구글 캘린더 딥링크 ───
      else if (target.includes("calendar.google.com")) {
        const webUrl = target;
        // 프로토콜 제거
        const urlNoProto = webUrl.replace(/^https?:\/\//, "");
        if (/Android/.test(navigator.userAgent)) {
          // Android Intent: com.google.android.calendar 패키지로
          target =
            `intent://${urlNoProto}` +
            `#Intent;scheme=https;package=com.google.android.calendar;` +
            `S.browser_fallback_url=${encodeURIComponent(webUrl)};end`;
        }
        else if (/iPhone|iPad|iPod/.test(navigator.userAgent)) {
          // iOS: googlecalendar:// 스킴 사용&#8203;:contentReference[oaicite:0]{index=0}
          target = `googlecalendar://${urlNoProto}`;
        }
        else {
          target = webUrl;
        }
      }

      // 미쓰리서명앱만 카카오톡 인앱 브라우저에서 외부 브라우저로 열기
      if (navigator.userAgent.includes('KAKAOTALK') && doc === '미쓰리서명앱' && params.get('mobile') === '1') {
        const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);

        if (isIOS) {
          // iOS: Chrome으로 자동 시도 후 실패하면 안내
          const chromeUrl = `googlechrome://${target.replace('https://', '')}`;

          // Chrome 자동 열기 시도
          window.location.href = chromeUrl;

          // 3초 후에도 페이지에 있으면 수동 안내 표시
          setTimeout(() => {
            document.body.innerHTML = `
              <div style="text-align: center; padding: 50px 20px; font-family: Arial, sans-serif;">
                <h2>🔗 Chrome에서 열기</h2>
                <p>Chrome이 설치되어 있지 않거나 자동으로 열리지 않았습니다</p>
                <br>
                <a href="${chromeUrl}" style="
                  background: #4285f4;
                  color: white;
                  padding: 15px 30px;
                  text-decoration: none;
                  border-radius: 8px;
                  display: inline-block;
                  font-weight: bold;
                  font-size: 16px;
                ">다시 Chrome에서 열기</a>
                <br><br>
                <a href="${target}" style="
                  background: #007bff;
                  color: white;
                  padding: 15px 30px;
                  text-decoration: none;
                  border-radius: 8px;
                  display: inline-block;
                  font-weight: bold;
                  font-size: 16px;
                  margin-top: 10px;
                ">Safari에서 열기</a>
              </div>
            `;
          }, 3000);

        } else {
          // 안드로이드: Chrome으로 자동 시도 후 실패하면 기본 브라우저
          const chromeIntent = `intent://${target.replace('https://', '')}#Intent;scheme=https;package=com.android.chrome;end`;

          // Chrome 자동 열기 시도
          window.location.href = chromeIntent;

          // 1초 후에도 페이지에 있으면 기본 브라우저로 폴백
          setTimeout(() => {
            window.open(target, '_blank');
          }, 1000);
        }
        return;
      }

      // 최종 리디렉션
      window.location.replace(target);
    };
  </script>
</head>
<body>
  <p>📄 문서로 이동 중입니다...</p>
</body>
</html>
